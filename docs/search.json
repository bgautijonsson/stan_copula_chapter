[
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "Copulas",
    "section": "",
    "text": "Copulas provide a flexible way to model multivariate distributions by separating the marginal distributions from the dependence structure. This chapter introduces copulas in Stan, focusing on implementation techniques and practical examples.\n\n\nCopulas are functions that join univariate marginal distributions to form multivariate distributions. According to Sklar’s theorem, any multivariate distribution can be expressed in terms of its marginals and a copula that captures the dependence structure.\nFor a multivariate random variable \\(X = (X_1, \\ldots, X_D)\\) with marginal distribution functions \\(F_i\\), the joint distribution can be written as:\n\\[\nH(X) = C(F_1(X_1), \\ldots, F_D(X_D))\n\\]\nwhere \\(C\\) is the copula function, \\(H\\) is the joint cumulative distribution function, and \\(F_i\\) are the marginal CDFs.\n\n\n\nWhen implementing copulas in Stan, we follow a general pattern that separates the marginal distributions from the dependence structure. The log density of a multivariate distribution using a copula can be written as:\n\\[\n\\log h(X) = \\log c\\left(u_1, \\dots, u_D \\vert \\theta_{c}\\right) + \\sum_{i=1}^D \\log f_i(X_i \\vert \\theta_i)\n\\]\nwhere:\n\n\\(u_i = F_i(X_i \\vert \\theta_i)\\) are the probability integral transforms of the data\n\\(\\log c\\left(u_1, \\dots, u_D \\vert \\theta_{c}\\right)\\) is the log density of the copula\n\\(\\sum_{i=1}^D \\log f_i(X_i \\vert \\theta_i)\\) is the sum of the log densities of the marginals\n\nA typical Stan model for copulas follows this structure:\nfunctions {\n  // Copula log density function\n  real log_c(vector u, vector theta_c) {\n    // Implementation of specific copula log density\n    // ...\n  }\n}\n\ndata {\n  int&lt;lower=0&gt; N;  // number of observations\n  int&lt;lower=0&gt; D;  // number of dimensions\n  matrix[N, D] X;  // data\n}\n\nparameters {\n  // Parameters for marginal distributions\n  vector[...] theta_marginal;\n  \n  // Parameters for copula\n  vector[...] theta_copula;\n}\n\nmodel {\n  // Priors for parameters\n  // ...\n  \n  // Likelihood\n  for (n in 1:N) {\n    vector[D] u;\n    \n    // Compute marginal log densities and CDFs\n    for (d in 1:D) {\n      // Add marginal log density to target\n      target += marginal_lpdf(X[n, d] | theta_marginal);\n      \n      // Transform to uniform using marginal CDF\n      u[d] = marginal_cdf(X[n, d] | theta_marginal);\n    }\n    \n    // Add copula log density to target\n    target += log_c(u | theta_copula);\n  }\n}\nThis structure highlights the two key components when modeling with copulas:\n\nWe need both the PDFs and CDFs of the marginal distributions\nWe need a function that computes the log density of the copula for the transformed data\n\nEven the independence assumption can be viewed as a special case of a copula (the independence copula), where \\(\\log c(\\mathbf{u}) = 0\\), resulting in the familiar sum of marginal log densities.\n\n\n\nThe Gaussian copula is one of the most commonly used copulas due to its simplicity and interpretability. Here’s a basic implementation in Stan:\ndata {\n  int&lt;lower=0&gt; N;  // number of observations\n  int&lt;lower=0&gt; D;  // number of dimensions\n  vector&lt;lower=0&gt;[D] y[N];  // data\n}\n\nparameters {\n  // Parameters for exponential marginal distributions\n  vector&lt;lower=0&gt;[D] lambda;  // rate parameters\n  \n  // Correlation matrix for Gaussian copula\n  cholesky_factor_corr[D] L_Omega;\n}\n\nmodel {\n  // Priors\n  lambda ~ gamma(2, 1);  // prior for rate parameters\n  L_Omega ~ lkj_corr_cholesky(2);\n  \n  // Likelihood using Gaussian copula with exponential marginals\n  for (n in 1:N) {\n    vector[D] z;\n    for (d in 1:D) {\n      // Add exponential log density to target\n      target += exponential_lpdf(y[n, d] | lambda[d]);\n      \n      // Transform to uniform using exponential CDF\n      real u_d = exponential_cdf(y[n, d], lambda[d]);\n      \n      // Transform to standard normal\n      z[d] = inv_Phi(u_d);\n    }\n    // Multivariate normal log density with correlation matrix\n    z ~ multi_normal_cholesky(rep_vector(0, D), L_Omega);\n  }\n}\n\ngenerated quantities {\n  // Recover correlation matrix from Cholesky factor\n  matrix[D, D] Omega = multiply_lower_tri_self_transpose(L_Omega);\n}\n\n\n\nCopulas offer several advantages in statistical modeling:\n\nFlexibility: They allow combining any marginal distributions with various dependence structures.\nInterpretability: The marginal distributions and dependence structure can be modeled separately.\nTail dependence: Different copulas can capture different types of tail dependence.\n\n\n\n\nSeveral copula families are available for modeling different dependence structures:\n\nGaussian copula: Based on the multivariate normal distribution\nt copula: Based on the multivariate t distribution, with stronger tail dependence\nArchimedean copulas: Including Clayton, Gumbel, and Frank copulas\nVine copulas: For flexible modeling of high-dimensional dependencies"
  },
  {
    "objectID": "index.html#what-are-copulas",
    "href": "index.html#what-are-copulas",
    "title": "Copulas",
    "section": "",
    "text": "Copulas are functions that join univariate marginal distributions to form multivariate distributions. According to Sklar’s theorem, any multivariate distribution can be expressed in terms of its marginals and a copula that captures the dependence structure.\nFor a multivariate random variable \\(X = (X_1, \\ldots, X_D)\\) with marginal distribution functions \\(F_i\\), the joint distribution can be written as:\n\\[\nH(X) = C(F_1(X_1), \\ldots, F_D(X_D))\n\\]\nwhere \\(C\\) is the copula function, \\(H\\) is the joint cumulative distribution function, and \\(F_i\\) are the marginal CDFs."
  },
  {
    "objectID": "index.html#general-structure-of-copula-models-in-stan",
    "href": "index.html#general-structure-of-copula-models-in-stan",
    "title": "Copulas",
    "section": "",
    "text": "When implementing copulas in Stan, we follow a general pattern that separates the marginal distributions from the dependence structure. The log density of a multivariate distribution using a copula can be written as:\n\\[\n\\log h(X) = \\log c\\left(u_1, \\dots, u_D \\vert \\theta_{c}\\right) + \\sum_{i=1}^D \\log f_i(X_i \\vert \\theta_i)\n\\]\nwhere:\n\n\\(u_i = F_i(X_i \\vert \\theta_i)\\) are the probability integral transforms of the data\n\\(\\log c\\left(u_1, \\dots, u_D \\vert \\theta_{c}\\right)\\) is the log density of the copula\n\\(\\sum_{i=1}^D \\log f_i(X_i \\vert \\theta_i)\\) is the sum of the log densities of the marginals\n\nA typical Stan model for copulas follows this structure:\nfunctions {\n  // Copula log density function\n  real log_c(vector u, vector theta_c) {\n    // Implementation of specific copula log density\n    // ...\n  }\n}\n\ndata {\n  int&lt;lower=0&gt; N;  // number of observations\n  int&lt;lower=0&gt; D;  // number of dimensions\n  matrix[N, D] X;  // data\n}\n\nparameters {\n  // Parameters for marginal distributions\n  vector[...] theta_marginal;\n  \n  // Parameters for copula\n  vector[...] theta_copula;\n}\n\nmodel {\n  // Priors for parameters\n  // ...\n  \n  // Likelihood\n  for (n in 1:N) {\n    vector[D] u;\n    \n    // Compute marginal log densities and CDFs\n    for (d in 1:D) {\n      // Add marginal log density to target\n      target += marginal_lpdf(X[n, d] | theta_marginal);\n      \n      // Transform to uniform using marginal CDF\n      u[d] = marginal_cdf(X[n, d] | theta_marginal);\n    }\n    \n    // Add copula log density to target\n    target += log_c(u | theta_copula);\n  }\n}\nThis structure highlights the two key components when modeling with copulas:\n\nWe need both the PDFs and CDFs of the marginal distributions\nWe need a function that computes the log density of the copula for the transformed data\n\nEven the independence assumption can be viewed as a special case of a copula (the independence copula), where \\(\\log c(\\mathbf{u}) = 0\\), resulting in the familiar sum of marginal log densities."
  },
  {
    "objectID": "index.html#gaussian-copula-example",
    "href": "index.html#gaussian-copula-example",
    "title": "Copulas",
    "section": "",
    "text": "The Gaussian copula is one of the most commonly used copulas due to its simplicity and interpretability. Here’s a basic implementation in Stan:\ndata {\n  int&lt;lower=0&gt; N;  // number of observations\n  int&lt;lower=0&gt; D;  // number of dimensions\n  vector&lt;lower=0&gt;[D] y[N];  // data\n}\n\nparameters {\n  // Parameters for exponential marginal distributions\n  vector&lt;lower=0&gt;[D] lambda;  // rate parameters\n  \n  // Correlation matrix for Gaussian copula\n  cholesky_factor_corr[D] L_Omega;\n}\n\nmodel {\n  // Priors\n  lambda ~ gamma(2, 1);  // prior for rate parameters\n  L_Omega ~ lkj_corr_cholesky(2);\n  \n  // Likelihood using Gaussian copula with exponential marginals\n  for (n in 1:N) {\n    vector[D] z;\n    for (d in 1:D) {\n      // Add exponential log density to target\n      target += exponential_lpdf(y[n, d] | lambda[d]);\n      \n      // Transform to uniform using exponential CDF\n      real u_d = exponential_cdf(y[n, d], lambda[d]);\n      \n      // Transform to standard normal\n      z[d] = inv_Phi(u_d);\n    }\n    // Multivariate normal log density with correlation matrix\n    z ~ multi_normal_cholesky(rep_vector(0, D), L_Omega);\n  }\n}\n\ngenerated quantities {\n  // Recover correlation matrix from Cholesky factor\n  matrix[D, D] Omega = multiply_lower_tri_self_transpose(L_Omega);\n}"
  },
  {
    "objectID": "index.html#advantages-of-copulas",
    "href": "index.html#advantages-of-copulas",
    "title": "Copulas",
    "section": "",
    "text": "Copulas offer several advantages in statistical modeling:\n\nFlexibility: They allow combining any marginal distributions with various dependence structures.\nInterpretability: The marginal distributions and dependence structure can be modeled separately.\nTail dependence: Different copulas can capture different types of tail dependence."
  },
  {
    "objectID": "index.html#common-copula-families",
    "href": "index.html#common-copula-families",
    "title": "Copulas",
    "section": "",
    "text": "Several copula families are available for modeling different dependence structures:\n\nGaussian copula: Based on the multivariate normal distribution\nt copula: Based on the multivariate t distribution, with stronger tail dependence\nArchimedean copulas: Including Clayton, Gumbel, and Frank copulas\nVine copulas: For flexible modeling of high-dimensional dependencies"
  }
]